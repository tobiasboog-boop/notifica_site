---
layout: false
title: SSH-verbinding configureren - Notifica
permalink: /admin/tools/ssh-verbinding/
robots: noindex, nofollow
---
<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSH-verbinding configureren - Notifica</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #16136F;
            --primary-light: #3636A2;
            --primary-pale: #e8eaff;
            --success: #16a34a;
            --success-pale: #dcfce7;
            --warning: #f59e0b;
            --warning-pale: #fef3c7;
            --danger: #dc2626;
            --danger-pale: #fee2e2;
            --info: #0284c7;
            --info-pale: #e0f2fe;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-900: #111827;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; color: var(--gray-700); background: var(--gray-50); }
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: 2rem; box-shadow: 0 4px 20px rgba(22, 19, 111, 0.15); }
        .header-content { max-width: 900px; margin: 0 auto; }
        .header h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px; }
        .header p { font-size: 0.95rem; opacity: 0.9; }
        .header-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; margin-bottom: 12px; }
        .progress-bar { background: white; border-bottom: 1px solid var(--gray-200); padding: 16px 24px; position: sticky; top: 0; z-index: 100; }
        .progress-content { max-width: 900px; margin: 0 auto; }
        .progress-steps { display: flex; justify-content: space-between; position: relative; }
        .progress-steps::before { content: ''; position: absolute; top: 16px; left: 40px; right: 40px; height: 2px; background: var(--gray-200); }
        .progress-step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 1; }
        .progress-step .number { width: 32px; height: 32px; border-radius: 50%; background: var(--gray-200); color: var(--gray-500); display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; margin-bottom: 8px; transition: all 0.3s; }
        .progress-step.active .number { background: var(--primary); color: white; }
        .progress-step.completed .number { background: var(--success); color: white; }
        .progress-step .label { font-size: 0.75rem; color: var(--gray-500); text-align: center; max-width: 80px; }
        .progress-step.active .label { color: var(--primary); font-weight: 600; }
        .container { max-width: 900px; margin: 0 auto; padding: 32px 24px 80px; }
        .section { background: white; border-radius: 16px; padding: 32px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.03); }
        .section.highlight { border-top: 3px solid var(--primary); }
        .section h2 { font-size: 1.25rem; font-weight: 600; color: var(--gray-900); margin-bottom: 16px; display: flex; align-items: center; gap: 12px; }
        .section h3 { font-size: 1rem; font-weight: 600; color: var(--gray-900); margin: 24px 0 12px 0; }
        .section p { color: var(--gray-600); margin-bottom: 12px; }
        .diagram-section { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 12px; padding: 24px; margin: 20px 0; }
        .diagram-section h4 { font-size: 0.9rem; font-weight: 600; color: var(--gray-700); margin-bottom: 16px; }
        .diagram-section.preferred { background: var(--success-pale); border-color: #bbf7d0; }
        .diagram-section.preferred h4 { color: var(--success); }
        .diagram { display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; font-family: 'SF Mono', 'Consolas', monospace; font-size: 0.85rem; }
        .diagram-box { background: white; border: 2px solid var(--gray-300); border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 100px; }
        .diagram-box.notifica { border-color: var(--primary); background: var(--primary-pale); }
        .diagram-box.tunnel { border-color: var(--success); background: var(--success-pale); border-style: dashed; }
        .diagram-box.server { border-color: var(--info); background: var(--info-pale); }
        .diagram-box.database { border-color: var(--warning); background: var(--warning-pale); }
        .diagram-box .icon { font-size: 1.5rem; margin-bottom: 4px; }
        .diagram-box .label { font-size: 0.75rem; font-weight: 600; color: var(--gray-700); }
        .diagram-arrow { color: var(--gray-400); font-size: 1.25rem; }
        .diagram-note { font-size: 0.8rem; color: var(--gray-500); margin-top: 12px; text-align: center; font-family: 'Inter', sans-serif; }
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 20px 0; }
        .summary-card { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 12px; padding: 20px; text-align: center; }
        .summary-card .icon { font-size: 2rem; margin-bottom: 8px; }
        .summary-card h4 { font-size: 0.9rem; font-weight: 600; color: var(--gray-900); margin-bottom: 4px; }
        .summary-card p { font-size: 0.8rem; color: var(--gray-500); margin: 0; }
        .info-collapse { border: 1px solid var(--gray-200); border-radius: 8px; margin: 16px 0; }
        .info-collapse summary { padding: 14px 16px; cursor: pointer; font-weight: 500; color: var(--gray-700); list-style: none; display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; }
        .info-collapse summary::-webkit-details-marker { display: none; }
        .info-collapse summary::after { content: "‚ñº"; font-size: 0.7rem; color: var(--gray-400); transition: transform 0.2s; }
        .info-collapse[open] summary::after { transform: rotate(180deg); }
        .info-collapse .collapse-content { padding: 16px; border-top: 1px solid var(--gray-200); background: var(--gray-50); font-size: 0.9rem; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--gray-700); font-size: 0.9rem; }
        .form-group label.required::after { content: " *"; color: var(--danger); }
        .form-group input[type="text"], .form-group input[type="email"], .form-group input[type="tel"], .form-group input[type="password"], .form-group input[type="number"], .form-group select, .form-group textarea { width: 100%; padding: 12px 14px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: border-color 0.2s, box-shadow 0.2s; background: white; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(22, 19, 111, 0.1); }
        .form-group .hint { font-size: 0.8rem; color: var(--gray-500); margin-top: 6px; }
        .form-group textarea { font-family: 'SF Mono', 'Consolas', monospace; font-size: 0.85rem; resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .server-type-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 16px 0; }
        .server-type-option { border: 2px solid var(--gray-200); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; text-align: center; position: relative; }
        .server-type-option:hover { border-color: var(--gray-300); background: var(--gray-50); }
        .server-type-option.selected { border-color: var(--primary); background: var(--primary-pale); }
        .server-type-option.preferred::before { content: "Voorkeur"; position: absolute; top: -10px; right: 12px; background: var(--success); color: white; font-size: 0.7rem; font-weight: 600; padding: 2px 8px; border-radius: 4px; }
        .server-type-option .icon { font-size: 2rem; margin-bottom: 8px; }
        .server-type-option h4 { font-size: 0.95rem; font-weight: 600; color: var(--gray-900); margin-bottom: 4px; }
        .server-type-option p { font-size: 0.8rem; color: var(--gray-500); margin: 0; }
        .conditional-field { display: none; }
        .conditional-field.visible { display: block; }
        .info-box { background: var(--info-pale); border: 1px solid #7dd3fc; border-radius: 10px; padding: 16px; margin: 16px 0; display: flex; gap: 12px; align-items: flex-start; font-size: 0.9rem; }
        .info-box .icon { font-size: 1.25rem; flex-shrink: 0; }
        .info-box .text strong { display: block; color: #0369a1; margin-bottom: 4px; }
        .info-box .text p { color: #0369a1; margin: 0; font-size: 0.85rem; }
        .warning-box { background: var(--warning-pale); border: 1px solid #fcd34d; border-radius: 10px; padding: 16px; margin: 16px 0; font-size: 0.9rem; }
        .warning-box strong { color: #92400e; }
        .warning-box p { color: #92400e; margin: 0; }
        .success-box { background: var(--success-pale); border: 1px solid #bbf7d0; border-radius: 10px; padding: 16px; margin: 16px 0; display: flex; gap: 12px; align-items: flex-start; font-size: 0.9rem; }
        .success-box .icon { font-size: 1.25rem; flex-shrink: 0; }
        .success-box .text strong { display: block; color: #166534; margin-bottom: 4px; }
        .success-box .text p { color: #166534; margin: 0; }
        .code-block { background: #1e293b; border-radius: 8px; padding: 14px 18px; margin: 12px 0; overflow-x: auto; font-family: 'SF Mono', 'Consolas', 'Monaco', monospace; font-size: 0.85rem; color: #e2e8f0; line-height: 1.5; white-space: pre; }
        code { background: var(--gray-100); padding: 2px 6px; border-radius: 4px; font-family: 'SF Mono', 'Consolas', monospace; font-size: 0.85em; color: var(--gray-900); }
        .config-step { border: 1px solid var(--gray-200); border-radius: 12px; margin-bottom: 16px; overflow: hidden; }
        .config-step-header { background: var(--gray-50); padding: 16px 20px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .config-step-header:hover { background: var(--gray-100); }
        .config-step-num { background: var(--primary); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 600; flex-shrink: 0; }
        .config-step.completed .config-step-num { background: var(--success); }
        .config-step-title { flex: 1; font-weight: 600; color: var(--gray-900); font-size: 0.95rem; }
        .config-step-check { color: var(--success); font-size: 1.25rem; display: none; }
        .config-step.completed .config-step-check { display: block; }
        .config-step-content { padding: 20px; border-top: 1px solid var(--gray-200); display: none; }
        .config-step.open .config-step-content { display: block; }
        .config-step-content p { margin-bottom: 12px; }
        .config-step-content ol { margin: 12px 0; padding-left: 20px; color: var(--gray-600); }
        .config-step-content ol li { margin-bottom: 8px; font-size: 0.9rem; }
        .step-complete-check { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 8px; margin-top: 16px; cursor: pointer; }
        .step-complete-check:hover { background: var(--gray-100); }
        .step-complete-check input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); cursor: pointer; }
        .step-complete-check label { font-size: 0.9rem; color: var(--gray-700); cursor: pointer; flex: 1; }
        .checkbox-group { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 8px; margin-top: 16px; }
        .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); cursor: pointer; }
        .checkbox-group label { font-size: 0.9rem; color: var(--gray-700); cursor: pointer; }
        .expand-details { background: white; border: 1px solid var(--gray-200); border-radius: 8px; margin: 12px 0; }
        .expand-details summary { padding: 12px 16px; cursor: pointer; font-weight: 500; color: var(--gray-700); list-style: none; display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; }
        .expand-details summary::-webkit-details-marker { display: none; }
        .expand-details summary::after { content: "+"; font-size: 1.25rem; font-weight: 400; color: var(--gray-400); }
        .expand-details[open] summary::after { content: "‚àí"; }
        .expand-details[open] summary { border-bottom: 1px solid var(--gray-200); }
        .expand-details .details-content { padding: 16px; font-size: 0.9rem; background: var(--gray-50); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; border-radius: 8px; font-size: 1rem; font-weight: 600; text-decoration: none; border: none; cursor: pointer; transition: all 0.2s; font-family: inherit; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background: #0f0c4a; transform: translateY(-1px); }
        .btn-secondary { background: var(--gray-500); color: white; }
        .btn-secondary:hover:not(:disabled) { background: var(--gray-600); }
        .btn-outline { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-outline:hover { background: var(--primary-pale); }
        .btn:disabled { background: var(--gray-300); color: var(--gray-500); cursor: not-allowed; transform: none; }
        .button-group { display: flex; gap: 12px; margin-top: 24px; }
        .nav-buttons { display: flex; justify-content: space-between; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--gray-200); }
        #test-results { display: none; margin-top: 20px; background: var(--gray-50); padding: 20px; border-radius: 12px; border: 1px solid var(--gray-200); }
        #test-results h4 { margin: 0 0 16px 0; font-size: 1rem; color: var(--gray-900); }
        .test-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; background: white; margin-bottom: 8px; border-radius: 8px; border: 1px solid var(--gray-200); font-size: 0.9rem; }
        .test-icon { font-size: 1.25rem; width: 28px; text-align: center; }
        .test-icon.success { color: var(--success); }
        .test-icon.error { color: var(--danger); }
        .test-icon.pending { color: var(--gray-400); }
        .test-message { flex: 1; }
        .test-detail { font-size: 0.8rem; color: var(--gray-500); margin-top: 4px; }
        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.7s linear infinite; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .ps-validation { margin: 16px 0; padding: 16px; border-radius: 8px; font-size: 0.9rem; }
        .ps-validation.success { background: var(--success-pale); border: 1px solid #bbf7d0; }
        .ps-validation.warning { background: var(--warning-pale); border: 1px solid #fcd34d; }
        .ps-validation.error { background: var(--danger-pale); border: 1px solid #fecaca; }
        .ps-validation h4 { margin: 0 0 8px 0; font-size: 0.95rem; }
        .ps-validation ul { margin: 0; padding-left: 20px; }
        .ps-ok { color: var(--success); }
        .ps-fout { color: var(--danger); }
        .ps-warn { color: var(--warning); }
        .security-list { list-style: none; margin: 16px 0; }
        .security-list li { display: flex; align-items: flex-start; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--gray-100); font-size: 0.9rem; }
        .security-list li:last-child { border-bottom: none; }
        .security-list .check { color: var(--success); font-size: 1rem; flex-shrink: 0; margin-top: 2px; }
        .wizard-section { display: none; }
        .wizard-section.active { display: block; }
        @media (max-width: 640px) {
            .container { padding: 24px 16px 64px; }
            .section { padding: 24px 20px; }
            .form-row, .server-type-selector, .summary-grid { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; }
            .progress-steps::before { left: 20px; right: 20px; }
            .progress-step .label { font-size: 0.65rem; max-width: 60px; }
            .diagram { flex-direction: column; }
            .diagram-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <span class="header-badge">VOOR IT-BEHEERDERS</span>
            <h1>SSH-verbinding configureren</h1>
            <p>Beveiligde toegang tot de Firebird-database voor Notifica dashboards</p>
        </div>
    </header>

    <div class="progress-bar">
        <div class="progress-content">
            <div class="progress-steps">
                <div class="progress-step active" data-step="1">
                    <div class="number">1</div>
                    <div class="label">Intake</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="number">2</div>
                    <div class="label">SSH-tunnel</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="number">3</div>
                    <div class="label">Database</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="number">4</div>
                    <div class="label">Verificatie</div>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
        <form id="ssh-config-form">
            <input type="hidden" id="klantnummer" name="klantnummer" value="">
            <input type="hidden" id="referentie" name="referentie" value="">
            <input type="hidden" id="kaarttitel" name="kaarttitel" value="">
            <input type="hidden" id="cardid" name="cardid" value="">

            <!-- STAP 1: INTAKE -->
            <div class="wizard-section active" id="step-1">
                <div id="ticket-info-display" class="info-box" style="display: none; margin-bottom: 24px;">
                    <div class="icon">üé´</div>
                    <div class="text" id="ticket-info-content"></div>
                </div>

                <div class="section">
                    <h2>Wat gaan we doen?</h2>
                    
                    <p><strong>Voor wie is dit?</strong><br>
                    U heeft dit ontvangen omdat uw klant een Notifica-abonnement heeft afgesloten. Wij bouwen Power BI dashboards en halen daarvoor data op uit de Syntess Firebird-database.</p>
                    
                    <p><strong>Wat richten we in?</strong><br>
                    Om veilig data op te halen, zetten we een SSH-tunnel op naar de Firebird-database. De tunnel wordt technisch beperkt tot <em>uitsluitend port forwarding naar poort 3050</em> ‚Äî meer is niet mogelijk.</p>

                    <div class="diagram-section preferred">
                        <h4>‚úì Optie A: Direct op de Firebird-server (voorkeur)</h4>
                        <div class="diagram">
                            <div class="diagram-box notifica">
                                <div class="icon">üè¢</div>
                                <div class="label">Notifica</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box tunnel">
                                <div class="icon">üîí</div>
                                <div class="label">SSH-tunnel</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box server">
                                <div class="icon">üñ•Ô∏è</div>
                                <div class="label">Firebird-server</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box database">
                                <div class="icon">üóÑÔ∏è</div>
                                <div class="label">Database</div>
                            </div>
                        </div>
                        <p class="diagram-note">Minder configuratie, minder punten die fout kunnen gaan.</p>
                    </div>

                    <div class="diagram-section">
                        <h4>Optie B: Via een jump server</h4>
                        <div class="diagram">
                            <div class="diagram-box notifica">
                                <div class="icon">üè¢</div>
                                <div class="label">Notifica</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box tunnel">
                                <div class="icon">üîí</div>
                                <div class="label">SSH-tunnel</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box server">
                                <div class="icon">üîÄ</div>
                                <div class="label">Jump server</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box server">
                                <div class="icon">üñ•Ô∏è</div>
                                <div class="label">Firebird-server</div>
                            </div>
                            <div class="diagram-arrow">‚Üí</div>
                            <div class="diagram-box database">
                                <div class="icon">üóÑÔ∏è</div>
                                <div class="label">Database</div>
                            </div>
                        </div>
                        <p class="diagram-note">Nodig wanneer de Firebird-server niet direct bereikbaar mag zijn vanaf internet.</p>
                    </div>

                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="icon">‚è±Ô∏è</div>
                            <h4>30-60 minuten</h4>
                            <p>Eenmalige configuratie</p>
                        </div>
                        <div class="summary-card">
                            <div class="icon">üîí</div>
                            <h4>Alleen poort 3050</h4>
                            <p>Technisch afgedwongen beperking</p>
                        </div>
                        <div class="summary-card">
                            <div class="icon">üõ°Ô∏è</div>
                            <h4>IP-whitelist</h4>
                            <p>Alleen Notifica IP's toegestaan</p>
                        </div>
                    </div>

                    <details class="info-collapse">
                        <summary>Meer over beveiliging</summary>
                        <div class="collapse-content">
                            <ul class="security-list">
                                <li><span class="check">‚úì</span><span>Poort 49222 alleen toegankelijk vanaf Notifica IP-adressen</span></li>
                                <li><span class="check">‚úì</span><span>SSH-gebruiker heeft alleen tunnel-toegang, geen shell</span></li>
                                <li><span class="check">‚úì</span><span>Tunnel technisch beperkt tot alleen poort 3050</span></li>
                                <li><span class="check">‚úì</span><span>Aparte database-authenticatie vereist</span></li>
                            </ul>
                        </div>
                    </details>
                </div>

                <div class="section highlight">
                    <h2>Uw gegevens</h2>
                    <p>Vul uw contactgegevens in zodat we u kunnen bereiken bij vragen.</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="klantnaam" class="required">Naam van de eindklant</label>
                            <input type="text" id="klantnaam" name="klantnaam" required placeholder="Bedrijf waarvoor dit wordt opgezet">
                        </div>
                        <div class="form-group">
                            <label for="bedrijfsnaam" class="required">Uw bedrijfsnaam (IT-leverancier)</label>
                            <input type="text" id="bedrijfsnaam" name="bedrijfsnaam" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="contactpersoon" class="required">Uw naam</label>
                            <input type="text" id="contactpersoon" name="contactpersoon" required>
                        </div>
                        <div class="form-group">
                            <label for="email" class="required">E-mailadres</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="telefoon" class="required">Telefoonnummer</label>
                        <input type="tel" id="telefoon" name="telefoon" required>
                    </div>
                </div>

                <div id="step1-validation-error" class="warning-box" style="display: none;">
                    <p><strong>Niet alle velden zijn correct ingevuld</strong></p>
                    <p id="step1-missing-fields"></p>
                </div>

                <div class="nav-buttons">
                    <div></div>
                    <button type="button" class="btn btn-primary" onclick="goToStep(2)">Naar SSH-tunnel configuratie ‚Üí</button>
                </div>
            </div>

            <!-- STAP 2: SSH-TUNNEL -->
            <div class="wizard-section" id="step-2">
                <div class="section">
                    <h2>SSH-tunnel configureren</h2>
                    <p>Volg onderstaande stappen om de beveiligde tunnel op te zetten.</p>

                    <div class="config-step open" id="config-step-1">
                        <div class="config-step-header" onclick="toggleConfigStep(1)">
                            <div class="config-step-num">1</div>
                            <div class="config-step-title">Firewall whitelisten</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>Sta inkomend TCP-verkeer toe op poort <strong>49222</strong>, maar <strong>uitsluitend</strong> voor deze Notifica IP-adressen:</p>
                            <div class="code-block">87.106.209.107
85.215.150.12
85.215.208.169
85.215.176.135</div>
                            <div class="info-box">
                                <div class="icon">‚ÑπÔ∏è</div>
                                <div class="text"><p>Dit kan in de Windows Firewall of in uw netwerk-firewall. Beide is het veiligst.</p></div>
                            </div>
                            <div class="step-complete-check">
                                <input type="checkbox" id="check-firewall" onchange="updateStepStatus(1)">
                                <label for="check-firewall">Firewall geconfigureerd met whitelist</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-2">
                        <div class="config-step-header" onclick="toggleConfigStep(2)">
                            <div class="config-step-num">2</div>
                            <div class="config-step-title">Port forwarding instellen</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>Stel op de router een port forward in:</p>
                            <div class="code-block">Externe poort 49222 ‚Üí Server met OpenSSH (interne poort 49222)</div>
                            <div class="step-complete-check">
                                <input type="checkbox" id="check-portforward" onchange="updateStepStatus(2)">
                                <label for="check-portforward">Port forwarding ingesteld</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-3">
                        <div class="config-step-header" onclick="toggleConfigStep(3)">
                            <div class="config-step-num">3</div>
                            <div class="config-step-title">OpenSSH Server installeren</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p><strong>Waar installeert u OpenSSH?</strong></p>
                            <p>Installeer bij voorkeur op de Firebird-server. Kan dat niet? Dan op een andere server (jump server).</p>

                            <details class="expand-details">
                                <summary>Windows Server 2019+</summary>
                                <div class="details-content">
                                    <div class="code-block">Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
Start-Service sshd
Set-Service -Name sshd -StartupType Automatic</div>
                                </div>
                            </details>

                            <details class="expand-details">
                                <summary>Windows Server 2016 en ouder</summary>
                                <div class="details-content">
                                    <p>Download van <a href="https://github.com/PowerShell/Win32-OpenSSH/releases" target="_blank">github.com/PowerShell/Win32-OpenSSH</a></p>
                                    <div class="code-block">cd "C:\Program Files\OpenSSH"
.\install-sshd.ps1
Start-Service sshd
Set-Service -Name sshd -StartupType Automatic</div>
                                </div>
                            </details>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-openssh" onchange="updateStepStatus(3)">
                                <label for="check-openssh">OpenSSH Server ge√Ønstalleerd en gestart</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-4">
                        <div class="config-step-header" onclick="toggleConfigStep(4)">
                            <div class="config-step-num">4</div>
                            <div class="config-step-title">Locatie en IP-gegevens</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p><strong>Waar heeft u OpenSSH ge√Ønstalleerd?</strong></p>
                            
                            <div class="server-type-selector">
                                <div class="server-type-option preferred" data-value="direct" onclick="selectServerType('direct')">
                                    <div class="icon">üñ•Ô∏è</div>
                                    <h4>Op de Firebird-server</h4>
                                    <p>Zelfde server als de database</p>
                                </div>
                                <div class="server-type-option" data-value="jumpserver" onclick="selectServerType('jumpserver')">
                                    <div class="icon">üîÄ</div>
                                    <h4>Op een jump server</h4>
                                    <p>Andere server dan de database</p>
                                </div>
                            </div>
                            <input type="hidden" id="server-type" name="server-type" required>

                            <div id="server-type-selected" style="display: none; margin-top: 20px;">
                                <div class="form-group">
                                    <label for="extern-ip" class="required">Extern IP-adres</label>
                                    <input type="text" id="extern-ip" name="extern-ip" required pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" placeholder="bijv. 203.0.113.50">
                                    <div class="hint">Het publieke IP waarop wij poort 49222 kunnen bereiken</div>
                                </div>

                                <div class="form-group conditional-field" id="intern-ip-group">
                                    <label for="intern-ip" class="required">Intern IP-adres van de Firebird-server</label>
                                    <input type="text" id="intern-ip" name="intern-ip" pattern="^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$" placeholder="bijv. 192.168.1.100">
                                    <div class="hint">Het interne IP waarop de jump server de Firebird-server kan bereiken</div>
                                </div>
                            </div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-location" onchange="updateStepStatus(4)" disabled>
                                <label for="check-location">Locatie en IP-gegevens ingevuld</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-5">
                        <div class="config-step-header" onclick="toggleConfigStep(5)">
                            <div class="config-step-num">5</div>
                            <div class="config-step-title">Gebruiker 'notifica' aanmaken</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>Maak een Windows-gebruiker aan met gebruikersnaam <code>notifica</code>.</p>

                            <details class="expand-details">
                                <summary>Instructies</summary>
                                <div class="details-content">
                                    <div class="code-block">$password = Read-Host -AsSecureString "Voer wachtwoord in"
New-LocalUser -Name "notifica" -Password $password -PasswordNeverExpires</div>
                                    <p style="margin-top: 12px;">Of via GUI: <code>lusrmgr.msc</code> ‚Üí Users ‚Üí New User</p>
                                </div>
                            </details>

                            <div class="form-group" style="margin-top: 16px;">
                                <label for="ssh-wachtwoord-input" class="required">Wachtwoord voor gebruiker 'notifica'</label>
                                <input type="password" id="ssh-wachtwoord-input" name="ssh-wachtwoord-input" placeholder="Voer het wachtwoord in dat u zojuist heeft aangemaakt">
                                <div class="hint">Dit wordt automatisch overgenomen naar de verificatiestap</div>
                            </div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-user" onchange="updateStepStatus(5)" disabled>
                                <label for="check-user">Gebruiker 'notifica' aangemaakt</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-6">
                        <div class="config-step-header" onclick="toggleConfigStep(6)">
                            <div class="config-step-num">6</div>
                            <div class="config-step-title">SSH configuratie aanpassen</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>Open het configuratiebestand:</p>
                            <div class="code-block">notepad "C:\ProgramData\ssh\sshd_config"</div>

                            <p style="margin-top: 16px;">Voeg toe (Match-blok onderaan):</p>
                            <div class="code-block" id="ssh-config-block">Port 49222
PasswordAuthentication yes
ChallengeResponseAuthentication no
PermitEmptyPasswords no
TCPKeepAlive yes
AllowTcpForwarding local
PermitOpen localhost:3050

Match User notifica
    ForceCommand cmd /c "echo Geen shell toegang && exit"
    PermitTTY no
    X11Forwarding no
    AllowAgentForwarding no</div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-sshconfig" onchange="updateStepStatus(6)">
                                <label for="check-sshconfig">SSH configuratie aangepast</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-7">
                        <div class="config-step-header" onclick="toggleConfigStep(7)">
                            <div class="config-step-num">7</div>
                            <div class="config-step-title">SSH service herstarten</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>Herstart de SSH service:</p>
                            <div class="code-block">Restart-Service sshd</div>
                            <div class="step-complete-check">
                                <input type="checkbox" id="check-restart" onchange="updateStepStatus(7)">
                                <label for="check-restart">SSH service herstart</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button type="button" class="btn btn-outline" onclick="goToStep(1)">‚Üê Terug</button>
                    <button type="button" class="btn btn-primary" onclick="goToStep(3)">Naar database configuratie ‚Üí</button>
                </div>
            </div>

            <!-- STAP 3: DATABASE -->
            <div class="wizard-section" id="step-3">
                <div class="section">
                    <h2>Database-verbinding configureren</h2>
                    <p>Nu de SSH-tunnel staat, configureren we de toegang tot de Firebird-database.</p>

                    <div class="info-box" style="margin-bottom: 24px;">
                        <div class="icon">üìã</div>
                        <div class="text">
                            <strong>Uw SSH-configuratie</strong>
                            <p id="config-summary">Type: <span id="sum-type">-</span> | Extern IP: <span id="sum-extern-ip">-</span><span id="sum-intern-ip-container" style="display:none;"> | Intern IP: <span id="sum-intern-ip">-</span></span></p>
                        </div>
                    </div>

                    <div class="config-step open" id="config-step-db-1">
                        <div class="config-step-header" onclick="toggleConfigStep('db-1')">
                            <div class="config-step-num">1</div>
                            <div class="config-step-title">Database locatie</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <div class="form-group">
                                <label for="database-pad" class="required">Volledig pad naar de database</label>
                                <input type="text" id="database-pad" name="database-pad" required placeholder="bijv. E:\data\atrium.fdb">
                                <div class="hint">Inclusief bestandsnaam (meestal atrium.fdb voor Syntess)</div>
                            </div>

                            <div class="form-group">
                                <label for="firebird-poort" class="required">Firebird poort</label>
                                <input type="number" id="firebird-poort" name="firebird-poort" value="3050" required min="1" max="65535">
                                <div class="hint">Standaard is 3050</div>
                            </div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-db-location" onchange="updateDbStepStatus('db-1')">
                                <label for="check-db-location">Database locatie ingevuld</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-db-2">
                        <div class="config-step-header" onclick="toggleConfigStep('db-2')">
                            <div class="config-step-num">2</div>
                            <div class="config-step-title">Leesrechten instellen</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>De gebruiker <code>notifica</code> heeft <strong>leesrechten</strong> nodig op de database map.</p>

                            <details class="expand-details">
                                <summary>Instructies</summary>
                                <div class="details-content">
                                    <ol>
                                        <li>Rechtsklik op de database map ‚Üí Properties ‚Üí Security</li>
                                        <li>Edit ‚Üí Add ‚Üí typ <code>notifica</code></li>
                                        <li>Geef <strong>Read</strong> rechten ‚Üí OK</li>
                                    </ol>
                                </div>
                            </details>

                            <div class="info-box" id="jumpserver-rechten-note" style="display: none;">
                                <div class="icon">‚ö†Ô∏è</div>
                                <div class="text">
                                    <strong>Jump server configuratie</strong>
                                    <p>De gebruiker <code>notifica</code> moet ook op de Firebird-server bestaan, of gebruik een domeingebruiker.</p>
                                </div>
                            </div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-db-rechten" onchange="updateDbStepStatus('db-2')">
                                <label for="check-db-rechten">Leesrechten ingesteld</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-db-3">
                        <div class="config-step-header" onclick="toggleConfigStep('db-3')">
                            <div class="config-step-num">3</div>
                            <div class="config-step-title">Database inloggegevens</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <p>De Firebird database credentials (anders dan de Windows-gebruiker).</p>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="db-gebruiker" class="required">Database gebruiker</label>
                                    <input type="text" id="db-gebruiker" name="db-gebruiker" value="atrium" required>
                                    <div class="hint">Standaard: atrium</div>
                                </div>
                                <div class="form-group">
                                    <label for="db-wachtwoord" class="required">Database wachtwoord</label>
                                    <input type="password" id="db-wachtwoord" name="db-wachtwoord" required>
                                    <div class="hint">Standaard: syntess</div>
                                </div>
                            </div>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-db-credentials" onchange="updateDbStepStatus('db-3')">
                                <label for="check-db-credentials">Database inloggegevens ingevuld</label>
                            </div>
                        </div>
                    </div>

                    <div class="config-step" id="config-step-db-4">
                        <div class="config-step-header" onclick="toggleConfigStep('db-4')">
                            <div class="config-step-num">4</div>
                            <div class="config-step-title">Configuratie testen met script</div>
                            <div class="config-step-check">‚úì</div>
                        </div>
                        <div class="config-step-content">
                            <div class="info-box">
                                <div class="icon">üì•</div>
                                <div class="text">
                                    <strong>Download het testscript</strong>
                                    <p><a href="#" onclick="downloadTestScript(); return false;" style="color: #0369a1;">Test-SSHConfiguratie.ps1</a></p>
                                </div>
                            </div>

                            <ol>
                                <li>Open PowerShell als Administrator</li>
                                <li>Voer uit: <code>.\Test-SSHConfiguratie.ps1</code></li>
                                <li>Kopieer de volledige output</li>
                            </ol>

                            <div class="step-complete-check">
                                <input type="checkbox" id="check-db-test" onchange="updateDbStepStatus('db-4')">
                                <label for="check-db-test">Testscript uitgevoerd</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button type="button" class="btn btn-outline" onclick="goToStep(2)">‚Üê Terug</button>
                    <button type="button" class="btn btn-primary" onclick="goToStep(4)">Naar verificatie ‚Üí</button>
                </div>
            </div>

            <!-- STAP 4: VERIFICATIE -->
            <div class="wizard-section" id="step-4">
                <div class="section highlight">
                    <h2>PowerShell testresultaat</h2>
                    <p>Plak hier de output van het testscript.</p>

                    <div class="form-group">
                        <textarea id="powershell-output" name="powershell-output" rows="8" required placeholder="Plak hier de volledige output van Test-SSHConfiguratie.ps1..."></textarea>
                    </div>

                    <div id="ps-validation" class="ps-validation" style="display: none;">
                        <div id="ps-validation-content"></div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="check-powershell" name="check-powershell" required disabled>
                        <label for="check-powershell">Testresultaat gevalideerd</label>
                    </div>
                </div>

                <div class="section highlight" id="ssh-wachtwoord-section">
                    <h2>SSH wachtwoord</h2>
                    <div id="ssh-wachtwoord-filled" style="display: none;">
                        <div class="info-box success">
                            <div class="icon">‚úì</div>
                            <div class="text"><strong>Wachtwoord overgenomen uit stap 2</strong></div>
                        </div>
                    </div>
                    <div id="ssh-wachtwoord-empty">
                        <div class="warning-box">
                            <p><strong>Let op:</strong> Gegevens worden versleuteld verzonden en niet opgeslagen.</p>
                        </div>
                        <div class="form-group">
                            <label for="ssh-wachtwoord" class="required">SSH wachtwoord (gebruiker: notifica)</label>
                            <input type="password" id="ssh-wachtwoord" name="ssh-wachtwoord">
                        </div>
                    </div>
                </div>

                <div class="section highlight">
                    <h2>Test en verstuur</h2>
                    <p>Wij testen of we via de SSH-tunnel bij de database kunnen komen.</p>

                    <div class="button-group">
                        <button type="button" id="btn-test" class="btn btn-secondary" onclick="runTest()">üîç Test configuratie</button>
                        <button type="submit" id="btn-submit" class="btn btn-primary" disabled>üì§ Verstuur formulier</button>
                    </div>

                    <div id="test-required-msg" class="info-box" style="margin-top: 20px;">
                        <div class="icon">‚ÑπÔ∏è</div>
                        <div class="text"><p>Voer eerst een succesvolle test uit.</p></div>
                    </div>

                    <div id="test-results">
                        <h4>Testresultaten</h4>
                        <div id="test-items"></div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button type="button" class="btn btn-outline" onclick="goToStep(3)">‚Üê Terug</button>
                    <div></div>
                </div>
            </div>
        </form>
    </main>

    <script>
        const API_URL = 'https://sugar-christmas-empty-dreams.trycloudflare.com/api/syntess';
        const STORAGE_KEY = 'notifica-ssh-wizard-v3';

        // PowerShell test script content
        function downloadTestScript() {
            const scriptContent = `# =============================================================================
# SSH Configuratie Test Script voor Notifica Firebird-koppeling
# =============================================================================
#
# INSTRUCTIES:
# ------------
# 1. Sla dit bestand op als "Test-SSHConfiguratie.ps1" op de server
# 2. Klik met rechtermuisknop op het bestand -> "Met PowerShell uitvoeren"
#    OF open PowerShell als Administrator en voer uit:
#
#    Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
#    .\\Test-SSHConfiguratie.ps1
#
# 3. Beantwoord de vragen over uw configuratie
# 4. Bekijk de resultaten (groen = OK, rood = FOUT, geel = WAARSCHUWING)
#
# Dit script controleert:
# - OpenSSH service status
# - Gebruiker 'notifica'
# - SSH configuratie (sshd_config)
# - Poort 49222
# - Firebird bereikbaarheid
# - Windows Firewall regels
#
# =============================================================================

# Kleuren voor output
function Write-OK { param($msg) Write-Host "   OK: $msg" -ForegroundColor Green }
function Write-Fout { param($msg) Write-Host "   FOUT: $msg" -ForegroundColor Red }
function Write-Waarschuwing { param($msg) Write-Host "   WAARSCHUWING: $msg" -ForegroundColor Yellow }
function Write-Info { param($msg) Write-Host "   $msg" -ForegroundColor Gray }

Clear-Host
Write-Host "============================================================" -ForegroundColor Cyan
Write-Host "  SSH Configuratie Test - Notifica Firebird-koppeling" -ForegroundColor Cyan
Write-Host "============================================================" -ForegroundColor Cyan
Write-Host ""

# -----------------------------------------------------------------------------
# Stap 0: Bepaal scenario (Firebird server of Jump server)
# -----------------------------------------------------------------------------
Write-Host "0. Type installatie" -ForegroundColor Yellow
Write-Host "   Is OpenSSH geinstalleerd op:" -ForegroundColor White
Write-Host "   [1] De Firebird/Syntess server (aanbevolen)" -ForegroundColor White
Write-Host "   [2] Een jump server (andere server dan Firebird)" -ForegroundColor White
$serverType = Read-Host "   Keuze (1 of 2)"

$isJumpServer = $serverType -eq "2"

if ($isJumpServer) {
    Write-Info "Scenario: Jump server"
    $firebirdIP = Read-Host "   Voer het interne IP-adres van de Firebird server in"
} else {
    Write-Info "Scenario: OpenSSH op Firebird server"
    $firebirdIP = "localhost"
}

$firebirdPoort = Read-Host "   Voer de Firebird poort in (Enter voor 3050)"
if ([string]::IsNullOrEmpty($firebirdPoort)) { $firebirdPoort = "3050" }

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 1: OpenSSH service status
# -----------------------------------------------------------------------------
Write-Host "1. OpenSSH Service Status" -ForegroundColor Yellow
$service = Get-Service -Name sshd -ErrorAction SilentlyContinue
if ($service) {
    if ($service.Status -eq "Running") {
        Write-OK "OpenSSH service draait"
    } else {
        Write-Fout "OpenSSH service is gestopt"
        Write-Info "Start met: Start-Service sshd"
    }

    # Check of service automatisch start
    $startType = (Get-WmiObject Win32_Service -Filter "Name='sshd'").StartMode
    if ($startType -eq "Auto") {
        Write-OK "Service start automatisch bij opstarten"
    } else {
        Write-Waarschuwing "Service start niet automatisch (huidige instelling: $startType)"
        Write-Info "Aanpassen met: Set-Service -Name sshd -StartupType Automatic"
    }
} else {
    Write-Fout "OpenSSH service niet gevonden - installeer OpenSSH Server"
}

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 2: Gebruiker notifica
# -----------------------------------------------------------------------------
Write-Host "2. Gebruiker notifica" -ForegroundColor Yellow
$user = Get-LocalUser -Name "notifica" -ErrorAction SilentlyContinue
if ($user) {
    Write-OK "Gebruiker notifica bestaat"

    if ($user.Enabled) {
        Write-OK "Account is actief"
    } else {
        Write-Fout "Account is uitgeschakeld"
    }

    if ($user.PasswordExpires) {
        Write-Waarschuwing "Wachtwoord verloopt op $($user.PasswordExpires)"
        Write-Info "Zet wachtwoord op 'verloopt nooit' in lusrmgr.msc"
    } else {
        Write-OK "Wachtwoord verloopt niet"
    }
} else {
    Write-Fout "Gebruiker notifica niet gevonden"
    Write-Info "Maak aan via lusrmgr.msc of: New-LocalUser -Name 'notifica'"
}

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 3: sshd_config controleren
# -----------------------------------------------------------------------------
Write-Host "3. SSH Configuratie (sshd_config)" -ForegroundColor Yellow
$configPath = "C:\\ProgramData\\ssh\\sshd_config"

if (Test-Path $configPath) {
    $config = Get-Content $configPath -Raw
    $configLines = Get-Content $configPath

    # Port check
    if ($config -match "(?m)^Port\\s+49222") {
        Write-OK "Port 49222 geconfigureerd"
    } else {
        Write-Fout "Port 49222 niet gevonden"
    }

    # PasswordAuthentication check
    if ($config -match "(?m)^PasswordAuthentication\\s+yes") {
        Write-OK "PasswordAuthentication yes"
    } else {
        Write-Fout "PasswordAuthentication niet op yes"
    }

    # ChallengeResponseAuthentication check
    if ($config -match "(?m)^ChallengeResponseAuthentication\\s+no") {
        Write-OK "ChallengeResponseAuthentication no"
    } else {
        Write-Waarschuwing "ChallengeResponseAuthentication no niet gevonden"
    }

    # TCPKeepAlive check
    if ($config -match "(?m)^TCPKeepAlive\\s+yes") {
        Write-OK "TCPKeepAlive yes"
    } else {
        Write-Waarschuwing "TCPKeepAlive yes niet gevonden"
    }

    # AllowTcpForwarding check
    if ($config -match "(?m)^AllowTcpForwarding\\s+local") {
        Write-OK "AllowTcpForwarding local"
    } else {
        Write-Waarschuwing "AllowTcpForwarding local niet gevonden (beveiliging)"
    }

    # PermitOpen check - afhankelijk van scenario
    $expectedPermitOpen = "\${firebirdIP}:\${firebirdPoort}"
    $permitOpenMatch = [regex]::Match($config, "(?m)^PermitOpen\\s+(.+)$")

    if ($permitOpenMatch.Success) {
        $actualPermitOpen = $permitOpenMatch.Groups[1].Value.Trim()
        if ($actualPermitOpen -eq $expectedPermitOpen) {
            Write-OK "PermitOpen $actualPermitOpen (correct voor dit scenario)"
        } else {
            Write-Waarschuwing "PermitOpen is '$actualPermitOpen', verwacht '$expectedPermitOpen'"
        }
    } else {
        Write-Waarschuwing "PermitOpen niet gevonden (beveiliging)"
        Write-Info "Verwacht: PermitOpen $expectedPermitOpen"
    }

    # Match User notifica check
    if ($config -match "(?m)^Match\\s+User\\s+notifica") {
        Write-OK "Match User notifica gevonden"

        # Check ForceCommand
        if ($config -match "ForceCommand") {
            Write-OK "ForceCommand geconfigureerd (geen shell toegang)"
        } else {
            Write-Waarschuwing "ForceCommand niet gevonden - gebruiker heeft mogelijk shell toegang"
        }

        # Check PermitTTY
        if ($config -match "PermitTTY\\s+no") {
            Write-OK "PermitTTY no"
        } else {
            Write-Waarschuwing "PermitTTY no niet gevonden"
        }
    } else {
        Write-Waarschuwing "Match User notifica niet gevonden (beveiliging)"
    }

} else {
    Write-Fout "sshd_config niet gevonden op $configPath"
}

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 4: Poort 49222 luistert
# -----------------------------------------------------------------------------
Write-Host "4. Poort 49222 luistert" -ForegroundColor Yellow
$listening = Get-NetTCPConnection -LocalPort 49222 -State Listen -ErrorAction SilentlyContinue
if ($listening) {
    Write-OK "Poort 49222 luistert"
} else {
    Write-Fout "Poort 49222 luistert niet"
    Write-Info "Herstart de SSH service: Restart-Service sshd"
}

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 5: Firebird bereikbaarheid
# -----------------------------------------------------------------------------
Write-Host "5. Firebird bereikbaarheid ($firebirdIP op poort $firebirdPoort)" -ForegroundColor Yellow

if ($isJumpServer) {
    # Test TCP-verbinding naar Firebird server
    $tcpTest = Test-NetConnection -ComputerName $firebirdIP -Port $firebirdPoort -WarningAction SilentlyContinue
    if ($tcpTest.TcpTestSucceeded) {
        Write-OK "Firebird server bereikbaar op \${firebirdIP}:\${firebirdPoort}"
    } else {
        Write-Fout "Kan Firebird server niet bereiken op \${firebirdIP}:\${firebirdPoort}"
        Write-Info "Controleer of Firebird draait en of de firewall verkeer toestaat"
    }
} else {
    # Lokale poort check
    $fbListening = Get-NetTCPConnection -LocalPort $firebirdPoort -State Listen -ErrorAction SilentlyContinue
    if ($fbListening) {
        Write-OK "Firebird poort $firebirdPoort luistert lokaal"
    } else {
        Write-Fout "Firebird poort $firebirdPoort luistert niet"
        Write-Info "Controleer of Firebird service draait"
    }
}

Write-Host ""

# -----------------------------------------------------------------------------
# Stap 6: Windows Firewall
# -----------------------------------------------------------------------------
Write-Host "6. Windows Firewall" -ForegroundColor Yellow

$fwRules = Get-NetFirewallRule -ErrorAction SilentlyContinue | Where-Object {
    $portFilter = $_ | Get-NetFirewallPortFilter -ErrorAction SilentlyContinue
    $portFilter.LocalPort -eq "49222"
}

if ($fwRules) {
    foreach ($rule in $fwRules) {
        $status = if ($rule.Enabled) { "actief" } else { "inactief" }
        Write-OK "Firewall regel gevonden: $($rule.DisplayName) ($status)"
    }
} else {
    Write-Waarschuwing "Geen specifieke firewall regel voor poort 49222 gevonden"
    Write-Info "Mogelijk geconfigureerd via externe firewall of groepsbeleid"
}

Write-Host ""

# -----------------------------------------------------------------------------
# Samenvatting
# -----------------------------------------------------------------------------
Write-Host "============================================================" -ForegroundColor Cyan
Write-Host "  Test voltooid" -ForegroundColor Cyan
Write-Host "============================================================" -ForegroundColor Cyan
Write-Host ""
Write-Host "Configuratie samenvatting:" -ForegroundColor White
Write-Host "  - Server type: $(if ($isJumpServer) { 'Jump server' } else { 'Firebird server' })" -ForegroundColor Gray
Write-Host "  - Firebird adres: \${firebirdIP}:\${firebirdPoort}" -ForegroundColor Gray
Write-Host "  - Verwachte PermitOpen: \${firebirdIP}:\${firebirdPoort}" -ForegroundColor Gray
Write-Host ""
Write-Host "============================================================" -ForegroundColor Yellow
Write-Host "  VOLGENDE STAP" -ForegroundColor Yellow
Write-Host "============================================================" -ForegroundColor Yellow
Write-Host ""
Write-Host "  1. Selecteer ALLE tekst in dit venster (Ctrl+A)" -ForegroundColor White
Write-Host "  2. Kopieer de tekst (Ctrl+C)" -ForegroundColor White
Write-Host "  3. Plak de tekst in het veld 'PowerShell testresultaat'" -ForegroundColor White
Write-Host "     in de SSH wizard op de Notifica website" -ForegroundColor White
Write-Host ""
Write-Host "============================================================" -ForegroundColor Yellow
Write-Host ""
Write-Host "Bij vragen of fouten, neem contact op met Notifica." -ForegroundColor Gray
Write-Host ""

Read-Host "Druk op Enter om af te sluiten"
`;
            const blob = new Blob([scriptContent], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Test-SSHConfiguratie.ps1';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // LocalStorage functions for form persistence
        function saveFormData() {
            const formFields = [
                'klantnaam', 'bedrijfsnaam', 'contactpersoon', 'email', 'telefoon',
                'server-type', 'extern-ip', 'intern-ip', 'database-pad', 'firebird-poort',
                'db-gebruiker', 'db-wachtwoord', 'powershell-output', 'ssh-wachtwoord-input'
            ];
            const checkboxes = [
                'check-firewall', 'check-portforward', 'check-openssh', 'check-location',
                'check-user', 'check-sshconfig', 'check-restart',
                'check-db-location', 'check-db-rechten', 'check-db-credentials', 'check-db-test'
            ];
            const data = { step: currentStep };
            formFields.forEach(id => {
                const el = document.getElementById(id);
                if (el) data[id] = el.value;
            });
            checkboxes.forEach(id => {
                const el = document.getElementById(id);
                if (el) data[id] = el.checked;
            });
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (e) { /* ignore storage errors */ }
        }

        function loadFormData() {
            try {
                const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (!data) return;

                // Restore form fields
                Object.keys(data).forEach(id => {
                    if (id === 'step') return;
                    const el = document.getElementById(id);
                    if (!el) return;
                    if (el.type === 'checkbox') {
                        el.checked = data[id];
                    } else {
                        el.value = data[id];
                    }
                });

                // Restore server type UI
                if (data['server-type']) {
                    selectServerType(data['server-type']);
                }

                // Restore step status
                ['firewall', 'portforward', 'openssh', 'location', 'user', 'sshconfig', 'restart'].forEach((id, i) => {
                    if (data['check-' + id]) {
                        document.getElementById('config-step-' + (i + 1)).classList.add('completed');
                    }
                });
                ['db-location', 'db-rechten', 'db-credentials', 'db-test'].forEach((id, i) => {
                    if (data['check-' + id]) {
                        document.getElementById('config-step-db-' + (i + 1)).classList.add('completed');
                    }
                });

                // Sync SSH password after loading
                if (data['ssh-wachtwoord-input']) {
                    setTimeout(syncSSHPassword, 50);
                }

                // Navigate to saved step
                if (data.step && data.step > 1) {
                    setTimeout(() => goToStep(data.step), 100);
                }
            } catch (e) { /* ignore storage errors */ }
        }

        function clearFormData() {
            try {
                localStorage.removeItem(STORAGE_KEY);
            } catch (e) { /* ignore */ }
        }

        // Auto-save on input changes
        document.addEventListener('input', saveFormData);
        document.addEventListener('change', saveFormData);

        // URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const kaarttitel = urlParams.get('kaarttitel') || '';
        const cardid = urlParams.get('cardid') || '';

        // Extract klantnummer from kaarttitel (zoek naar "Klantnummer:" gevolgd door cijfers)
        let klantnummer = urlParams.get('klantnummer') || '';
        if (!klantnummer && kaarttitel) {
            const klantnummerMatch = kaarttitel.match(/klantnummer:\s*(\d+)/i);
            if (klantnummerMatch) klantnummer = klantnummerMatch[1];
        }

        // Extract referentie from kaarttitel (zoek naar "REF" gevolgd door cijfers)
        let referentie = urlParams.get('referentie') || '';
        if (!referentie && kaarttitel) {
            const referentieMatch = kaarttitel.match(/REF(\d+)/i);
            if (referentieMatch) referentie = 'REF' + referentieMatch[1];
        }

        // Vul hidden fields
        document.getElementById('klantnummer').value = klantnummer;
        document.getElementById('referentie').value = referentie;
        document.getElementById('kaarttitel').value = kaarttitel;
        document.getElementById('cardid').value = cardid;

        if (kaarttitel || referentie) {
            document.getElementById('ticket-info-display').style.display = 'flex';
            let displayParts = [];
            if (referentie) displayParts.push('<span style="margin-right: 16px;"><strong>Referentie:</strong> ' + referentie + '</span>');
            if (klantnummer) displayParts.push('<span><strong>Klantnummer:</strong> ' + klantnummer + '</span>');
            document.getElementById('ticket-info-content').innerHTML = displayParts.join('');
        }

        // Load saved form data on page load
        document.addEventListener('DOMContentLoaded', loadFormData);

        // Wizard navigation
        let currentStep = 1;

        function goToStep(step) {
            if (step > currentStep) {
                if (currentStep === 1 && !validateStep1()) return;
                if (currentStep === 2 && !validateStep2()) return;
            }

            document.querySelectorAll('.wizard-section').forEach(s => s.classList.remove('active'));
            document.getElementById('step-' + step).classList.add('active');

            document.querySelectorAll('.progress-step').forEach(s => {
                const n = parseInt(s.dataset.step);
                s.classList.remove('active', 'completed');
                if (n === step) s.classList.add('active');
                if (n < step) s.classList.add('completed');
            });

            currentStep = step;

            if (step === 3) {
                updateConfigSummary();
                updateSSHConfigBlock();
                updateJumpserverNote();
            }

            window.scrollTo(0, 0);
        }

        function validateStep1() {
            const fields = ['klantnaam', 'bedrijfsnaam', 'contactpersoon', 'email', 'telefoon'];
            const labels = { klantnaam: 'Naam eindklant', bedrijfsnaam: 'Uw bedrijfsnaam', contactpersoon: 'Uw naam', email: 'E-mailadres', telefoon: 'Telefoonnummer' };
            const missing = fields.filter(f => !document.getElementById(f).value.trim() || !document.getElementById(f).checkValidity());

            if (missing.length > 0) {
                document.getElementById('step1-missing-fields').textContent = 'Ontbrekend: ' + missing.map(f => labels[f]).join(', ');
                document.getElementById('step1-validation-error').style.display = 'block';
                return false;
            }
            document.getElementById('step1-validation-error').style.display = 'none';
            return true;
        }

        function validateStep2() {
            const serverType = document.getElementById('server-type').value;
            const externIp = document.getElementById('extern-ip').value;
            if (!serverType || !externIp) { toggleConfigStep(4); return false; }
            if (serverType === 'jumpserver' && !document.getElementById('intern-ip').value) { toggleConfigStep(4); return false; }
            return true;
        }

        // Server type selector
        function selectServerType(type) {
            document.querySelectorAll('.server-type-option').forEach(o => o.classList.remove('selected'));
            document.querySelector('.server-type-option[data-value="' + type + '"]').classList.add('selected');
            document.getElementById('server-type').value = type;
            document.getElementById('server-type-selected').style.display = 'block';

            const internGroup = document.getElementById('intern-ip-group');
            const internInput = document.getElementById('intern-ip');
            if (type === 'jumpserver') {
                internGroup.classList.add('visible');
                internInput.required = true;
            } else {
                internGroup.classList.remove('visible');
                internInput.required = false;
                internInput.value = '';
            }
            validateStep4Fields();
        }

        function validateStep4Fields() {
            const type = document.getElementById('server-type').value;
            const ext = document.getElementById('extern-ip').value;
            const int = document.getElementById('intern-ip').value;
            const cb = document.getElementById('check-location');
            cb.disabled = !(type && ext && (type !== 'jumpserver' || int));
            if (cb.disabled) cb.checked = false;
        }

        document.getElementById('extern-ip').addEventListener('input', validateStep4Fields);
        document.getElementById('intern-ip').addEventListener('input', validateStep4Fields);

        // SSH password sync between step 2 and step 4
        function syncSSHPassword() {
            const inputField = document.getElementById('ssh-wachtwoord-input');
            const outputField = document.getElementById('ssh-wachtwoord');
            const filledSection = document.getElementById('ssh-wachtwoord-filled');
            const emptySection = document.getElementById('ssh-wachtwoord-empty');
            const checkUser = document.getElementById('check-user');

            if (inputField.value) {
                outputField.value = inputField.value;
                filledSection.style.display = 'block';
                emptySection.style.display = 'none';
                checkUser.disabled = false;
            } else {
                filledSection.style.display = 'none';
                emptySection.style.display = 'block';
                checkUser.disabled = true;
                checkUser.checked = false;
            }
        }

        document.getElementById('ssh-wachtwoord-input').addEventListener('input', syncSSHPassword);

        // Also sync from step 4 back to step 2 if manually entered
        document.getElementById('ssh-wachtwoord').addEventListener('input', function() {
            const inputField = document.getElementById('ssh-wachtwoord-input');
            if (!inputField.value && this.value) {
                inputField.value = this.value;
                syncSSHPassword();
            }
        });

        // Config summary
        function updateConfigSummary() {
            const type = document.getElementById('server-type').value;
            const ext = document.getElementById('extern-ip').value;
            const int = document.getElementById('intern-ip').value;
            document.getElementById('sum-type').textContent = type === 'direct' ? 'Direct' : 'Jump server';
            document.getElementById('sum-extern-ip').textContent = ext || '-';
            if (type === 'jumpserver' && int) {
                document.getElementById('sum-intern-ip').textContent = int;
                document.getElementById('sum-intern-ip-container').style.display = 'inline';
            } else {
                document.getElementById('sum-intern-ip-container').style.display = 'none';
            }
        }

        function updateSSHConfigBlock() {
            const type = document.getElementById('server-type').value;
            const poort = document.getElementById('firebird-poort').value || '3050';
            const int = document.getElementById('intern-ip').value;
            const permitOpen = type === 'jumpserver' && int ? 'PermitOpen ' + int + ':' + poort : 'PermitOpen localhost:' + poort;
            document.getElementById('ssh-config-block').textContent = 'Port 49222\nPasswordAuthentication yes\nChallengeResponseAuthentication no\nPermitEmptyPasswords no\nTCPKeepAlive yes\nAllowTcpForwarding local\n' + permitOpen + '\n\nMatch User notifica\n    ForceCommand cmd /c "echo Geen shell toegang && exit"\n    PermitTTY no\n    X11Forwarding no\n    AllowAgentForwarding no';
        }

        function updateJumpserverNote() {
            document.getElementById('jumpserver-rechten-note').style.display = document.getElementById('server-type').value === 'jumpserver' ? 'flex' : 'none';
        }

        document.getElementById('firebird-poort').addEventListener('input', updateSSHConfigBlock);

        // Config steps accordion
        function toggleConfigStep(num) {
            const step = document.getElementById('config-step-' + num);
            if (!step) return;
            const wasOpen = step.classList.contains('open');
            document.querySelectorAll('.config-step').forEach(s => s.classList.remove('open'));
            if (!wasOpen) step.classList.add('open');
        }

        function updateStepStatus(num) {
            const ids = ['firewall', 'portforward', 'openssh', 'location', 'user', 'sshconfig', 'restart'];
            const cb = document.getElementById('check-' + ids[num - 1]);
            const step = document.getElementById('config-step-' + num);
            if (cb && cb.checked) {
                step.classList.add('completed');
                if (num < 7) setTimeout(() => toggleConfigStep(num + 1), 300);
            } else {
                step.classList.remove('completed');
            }
        }

        function updateDbStepStatus(id) {
            const map = { 'db-1': 'db-location', 'db-2': 'db-rechten', 'db-3': 'db-credentials', 'db-4': 'db-test' };
            const next = { 'db-1': 'db-2', 'db-2': 'db-3', 'db-3': 'db-4' };
            const cb = document.getElementById('check-' + map[id]);
            const step = document.getElementById('config-step-' + id);
            if (cb && cb.checked) {
                step.classList.add('completed');
                if (next[id]) setTimeout(() => toggleConfigStep(next[id]), 300);
            } else {
                step.classList.remove('completed');
            }
        }

        // PowerShell validation
        document.getElementById('powershell-output').addEventListener('input', function() {
            const output = this.value;
            const valDiv = document.getElementById('ps-validation');
            const content = document.getElementById('ps-validation-content');
            const cb = document.getElementById('check-powershell');

            if (!output.trim()) { valDiv.style.display = 'none'; cb.disabled = true; cb.checked = false; return; }

            const ok = (output.match(/OK:/g) || []).length;
            const fout = (output.match(/FOUT:/g) || []).length;
            const warn = (output.match(/WAARSCHUWING:/g) || []).length;
            const valid = output.includes('SSH Configuratie Test') && output.includes('Test voltooid');

            let status = 'success', title = '‚úì Test geslaagd';
            if (!valid) { status = 'error'; title = '‚úó Ongeldige output'; }
            else if (fout > 0) { status = 'error'; title = '‚úó Test bevat fouten'; }
            else if (warn > 0) { status = 'warning'; title = '‚ö† Waarschuwingen'; }

            let html = '<h4>' + title + '</h4>';
            if (valid) {
                html += '<ul><li class="ps-ok">‚úì ' + ok + ' checks geslaagd</li>';
                if (fout > 0) html += '<li class="ps-fout">‚úó ' + fout + ' fouten</li>';
                if (warn > 0) html += '<li class="ps-warn">‚ö† ' + warn + ' waarschuwingen</li>';
                html += '</ul>';
            }

            content.innerHTML = html;
            valDiv.className = 'ps-validation ' + status;
            valDiv.style.display = 'block';
            cb.disabled = !(valid && fout === 0);
            if (cb.disabled) cb.checked = false;
        });

        // Test function
        async function runTest() {
            const btnTest = document.getElementById('btn-test');
            const btnSubmit = document.getElementById('btn-submit');
            const resultsDiv = document.getElementById('test-results');
            const msgDiv = document.getElementById('test-required-msg');

            for (const f of ['ssh-wachtwoord', 'db-gebruiker', 'db-wachtwoord']) {
                const el = document.getElementById(f);
                if (!el.value.trim()) { el.focus(); el.reportValidity(); return; }
            }

            btnTest.disabled = true;
            btnTest.innerHTML = '<span class="spinner"></span>Testen...';
            btnSubmit.disabled = true;
            resultsDiv.style.display = 'block';

            const tests = [
                { name: 'Poort 49222 bereikbaar', status: 'pending' },
                { name: 'SSH login (notifica)', status: 'pending' },
                { name: 'SSH tunnel opzetten', status: 'pending' },
                { name: 'Database poort via tunnel', status: 'pending' }
            ];
            renderTests(tests);

            try {
                const res = await fetch(API_URL + '/sshtest', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        extern_ip: document.getElementById('extern-ip').value,
                        intern_ip: document.getElementById('intern-ip').value || 'localhost',
                        firebird_poort: parseInt(document.getElementById('firebird-poort').value),
                        ssh_wachtwoord: document.getElementById('ssh-wachtwoord').value,
                        db_gebruiker: document.getElementById('db-gebruiker').value,
                        db_wachtwoord: document.getElementById('db-wachtwoord').value,
                        database_pad: document.getElementById('database-pad').value,
                        server_type: document.getElementById('server-type').value
                    })
                });
                const r = await res.json();

                tests[0].status = r.port_reachable ? 'success' : 'error'; tests[0].detail = r.port_message;
                tests[1].status = r.ssh_login ? 'success' : 'error'; tests[1].detail = r.ssh_message;
                tests[2].status = r.tunnel_works ? 'success' : 'error'; tests[2].detail = r.tunnel_message;
                tests[3].status = r.firebird_reachable ? 'success' : 'error'; tests[3].detail = r.firebird_message;
                renderTests(tests);

                if (r.port_reachable && r.ssh_login && r.tunnel_works && r.firebird_reachable) {
                    btnSubmit.disabled = false;
                    msgDiv.innerHTML = '<div class="icon">‚úì</div><div class="text"><strong>Alle tests geslaagd!</strong><p>U kunt nu versturen.</p></div>';
                    msgDiv.className = 'success-box';
                } else {
                    msgDiv.innerHTML = '<div class="icon">‚úó</div><div class="text"><strong>Test niet geslaagd</strong><p>Los de fouten op en test opnieuw.</p></div>';
                    msgDiv.className = 'warning-box';
                }
            } catch (e) {
                tests.forEach(t => { t.status = 'error'; t.detail = 'Verbinding met test-API mislukt'; });
                renderTests(tests);
                msgDiv.innerHTML = '<div class="icon">‚úó</div><div class="text"><strong>Test mislukt</strong><p>Kon geen verbinding maken.</p></div>';
                msgDiv.className = 'warning-box';
            }

            btnTest.disabled = false;
            btnTest.innerHTML = 'üîç Test opnieuw';
        }

        function renderTests(tests) {
            document.getElementById('test-items').innerHTML = tests.map(t => '<div class="test-item"><div class="test-icon ' + t.status + '">' + (t.status === 'pending' ? '‚óã' : t.status === 'success' ? '‚úì' : '‚úó') + '</div><div class="test-message"><div>' + t.name + '</div>' + (t.detail ? '<div class="test-detail">' + t.detail + '</div>' : '') + '</div></div>').join('');
        }

        // Form submit
        document.getElementById('ssh-config-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span>Versturen...';

            const fd = new FormData(this);
            const data = {
                datum: new Date().toISOString(),
                klantnummer: document.getElementById('klantnummer').value,
                referentie: document.getElementById('referentie').value,
                kaarttitel: document.getElementById('kaarttitel').value,
                cardid: document.getElementById('cardid').value,
                klantnaam: fd.get('klantnaam'),
                bedrijfsnaam: fd.get('bedrijfsnaam'),
                contactpersoon: fd.get('contactpersoon'),
                email: fd.get('email'),
                telefoon: fd.get('telefoon'),
                'server-type': fd.get('server-type'),
                'extern-ip': fd.get('extern-ip'),
                'intern-ip': fd.get('intern-ip') || 'localhost',
                'firebird-poort': fd.get('firebird-poort'),
                'database-pad': fd.get('database-pad'),
                'ssh-wachtwoord': fd.get('ssh-wachtwoord'),
                'db-gebruiker': fd.get('db-gebruiker'),
                'db-wachtwoord': fd.get('db-wachtwoord'),
                'powershell-output': fd.get('powershell-output')
            };

            try {
                const res = await fetch('https://prod-204.westeurope.logic.azure.com:443/workflows/d0e099be0461471299bf95f18afd5c23/triggers/When_an_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_an_HTTP_request_is_received%2Frun&sv=1.0&sig=UQwGZbPKxjvGN61WO2YRMFa5zHLmqH0xIadDiS75JcU', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok || res.status === 202) {
                    clearFormData();
                    alert('Formulier succesvol verzonden!\n\nWij controleren de verbinding en nemen contact op bij vragen.');
                } else {
                    alert('Er ging iets mis. Probeer opnieuw of neem contact op met Notifica.');
                }
            } catch (e) {
                alert('Kon niet versturen. Controleer uw internetverbinding.');
            }

            btn.disabled = false;
            btn.innerHTML = 'üì§ Verstuur formulier';
        });
    </script>

    <script>
        function sendHeight() { window.parent.postMessage({ type: 'setHeight', height: document.body.scrollHeight }, '*'); }
        window.addEventListener('load', sendHeight);
        window.addEventListener('resize', sendHeight);
        new MutationObserver(sendHeight).observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>
